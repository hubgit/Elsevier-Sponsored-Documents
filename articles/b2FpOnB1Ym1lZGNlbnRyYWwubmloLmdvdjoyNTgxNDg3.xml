<article xmlns="http://dtd.nlm.nih.gov/2.0/xsd/archivearticle" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://dtd.nlm.nih.gov/2.0/xsd/archivearticle http://dtd.nlm.nih.gov/2.0/xsd/archivearticle.xsd" article-type="announcement">
  <front>
    <journal-meta>
      <journal-id journal-id-type="nlm-ta">Neuroimage</journal-id>
      <journal-title>Neuroimage</journal-title>
      <issn pub-type="ppub">1053-8119</issn>
      <issn pub-type="epub">1095-9572</issn>
      <publisher>
        <publisher-name>Academic Press</publisher-name>
      </publisher>
    </journal-meta>
    <article-meta>
      <article-id pub-id-type="pmc">2581487</article-id>
      <article-id pub-id-type="pmid">18639641</article-id>
      <article-id pub-id-type="publisher-id">YNIMG5535</article-id>
      <article-id pub-id-type="doi">10.1016/j.neuroimage.2008.06.022</article-id>
      <article-categories>
        <subj-group subj-group-type="heading">
          <subject>Technical Note</subject>
        </subj-group>
      </article-categories>
      <title-group>
        <article-title>Electromagnetic source reconstruction for group studies</article-title>
      </title-group>
      <contrib-group>
        <contrib contrib-type="author">
          <name>
            <surname>Litvak</surname>
            <given-names>Vladimir</given-names>
          </name>
          <email>v.litvak@ion.ucl.ac.uk</email>
          <xref rid="cor1" ref-type="corresp">⁎</xref>
        </contrib>
        <contrib contrib-type="author">
          <name>
            <surname>Friston</surname>
            <given-names>Karl</given-names>
          </name>
        </contrib>
      </contrib-group>
      <aff>
        <addr-line>The Wellcome Trust Centre for Neuroimaging, University College London, UK</addr-line>
      </aff>
      <author-notes>
        <corresp id="cor1"><label>⁎</label>Corresponding author. The Wellcome Trust Centre for Neuroimaging, Institute of Neurology, UCL, 12 Queen Square, London, WC1N 3BG, United Kingdom. Tel.: +44 207 833 7454; fax: +44 207 813 1445. <email>v.litvak@ion.ucl.ac.uk</email></corresp>
      </author-notes>
      <pub-date pub-type="ppub">
        <day>01</day>
        <month>10</month>
        <year>2008</year>
      </pub-date>
      <volume>42</volume>
      <issue>4-24</issue>
      <fpage>1490</fpage>
      <lpage>1498</lpage>
      <history>
        <date date-type="received">
          <day>21</day>
          <month>4</month>
          <year>2008</year>
        </date>
        <date date-type="rev-recd">
          <day>6</day>
          <month>6</month>
          <year>2008</year>
        </date>
        <date date-type="accepted">
          <day>9</day>
          <month>6</month>
          <year>2008</year>
        </date>
      </history>
      <permissions>
        <copyright-statement>© 2008 Elsevier Inc.</copyright-statement>
        <copyright-year>2008</copyright-year>
        <copyright-holder>Elsevier Inc.</copyright-holder>
        <license>
          <p>This document may be redistributed and reused, subject to <ext-link ext-link-type="uri" xlink:href="http://www.elsevier.com/wps/find/authorsview.authors/supplementalterms1.0">certain conditions</ext-link>.</p>
        </license>
      </permissions>
      <abstract>
        <title>Abstract</title>
        <p>The aim of this paper is to describe a simple procedure for electromagnetic (EEG or MEG) source reconstruction, in the context of group studies. This entails a simple extension of existing source reconstiruction techniques based upon the inversion of hierarchical models. The extension ensures that evoked or induced responses are reconstructed in the same subset of sources, over subjects. Effectively, the procedure aligns the deployment of reconstructed activity over subjects and increases, substantially, the detection of differences between evoked or induced responses at the group or between-subject level.</p>
      </abstract>
      <kwd-group>
        <title>Keywords</title>
        <kwd>Hierarchical Bayes</kwd>
        <kwd>Source reconstruction</kwd>
        <kwd>EEG</kwd>
        <kwd>MEG</kwd>
        <kwd>Restricted maximum likelihood</kwd>
        <kwd>Automatic relevance determination</kwd>
      </kwd-group>
    </article-meta>
  </front>
  <body>
    <sec>
      <title>Introduction</title>
      <p>There has been considerable progress over the past few years in reconstructing electromagnetic source activity from channel data (<italic>e.g</italic>., <xref rid="bib2 bib17 bib18 bib19 bib20 bib23 bib9 bib13 bib16 bib24" ref-type="bibr">Baillet and Garnero, 1997; Phillips et al., 2002; Phillips et al. , 2005; Sato et al., 2004; Serinagaoglu et al., 2005; Trujillo-Barreto et al., 2004; Jun et al., 2006; Mattout et al., 2006; Nummenmaa et al., 2007; Wipf and Nagarajan, in press</xref>). These advances rest upon reformulating classical inversion approaches within a Bayesian framework and then using hierarchical or empirical Bayes (<xref rid="bib10 bib18 bib24" ref-type="bibr">Kass and Steffey, 1989; Phillips et al., 2005; Wipf and Nagarajan, in press</xref>) to optimise both the estimated sources <italic>and the constraints or priors themselves</italic>. This optimisation uses standard sampling or variational schemes to provide the most likely distribution of source activity, given observed data. While these reconstructions are optimal for data from a single subject or session, they are not optimal for detecting group differences. This is because the hierarchical model does not include a between-subject level and is therefore unable to exploit the fact that the same paradigm was repeated over subjects or sessions. The analysis described in this paper is based on two established approaches: the summary-statistic approach to hierarchical models and the use of a canonical mesh in source reconstruction.</p>
      <sec>
        <title>The summary-statistic approach</title>
        <p>The problem of making inferences about population responses is resolved by hierarchical models. In classical statistics, these are known as random or mixed-effects models that include random effects at the within and between-subject level. In Bayesian inference these are known as parametric empirical Bayes models, where between-subject variations in parameter estimates furnish constraints on within-subject estimation. Usually, these random effects or hierarchical models are inverted using data from all the subjects analysed. An alternative approach is to optimise the parameters of subject-specific models separately and use these optimised parameters as summary-statistics, which are then analysed in a second-level or between-subject model. This can be repeated until the top level of the hierarchical model is reached. Provided the models for each subject are the same, the summary-statistic approach gives, in expectation, exactly the same results as a full mixed-effects analysis. Furthermore, even if there are differences between the models at the single-subject level; the differences between the summary-statistic approach and a mixed-effects analysis are trivial (see <xref rid="bib3" ref-type="bibr">Friston et al., 2005</xref> for example in fMRI). In neuroimaging people generally use the summary-statistic approach because, computationally and conceptually, it is much simpler to implement; and because it avoids handling all the data from all the subjects at the same time. This is important in neuroimaging, where the size of datasets can be very large.</p>
        <p>In the analysis of group EEG and MEG studies, we anticipate that people will want to use a summary-statistic approach, in which a summary of evoked responses (within some time and frequency window) for each subject is optimised at the within-subject level and then passed to a simple ANOVA model at the second level, to produce statistical parametric maps (SPM) of regionally significant differences among trials. In this particular application, one would use Bayesian estimators as the summary-statistic at the within-subject level and classical statistics for inference at the between-subject level. However, for this two-stage procedure to work, the reconstructed activity at a particular source in one subject should correspond to the same source in the other subjects. This brings us to the notion of a canonical mesh.</p>
      </sec>
      <sec>
        <title>The canonical mesh</title>
        <p>To facilitate group-level analyses, we introduced the idea of a canonical mesh (<xref rid="bib14" ref-type="bibr">Mattout et al., 2007</xref>), which ensures that activity is reconstructed in the same source space over subjects (<xref rid="bib21" ref-type="bibr">Talairach and Tournoux, 1988</xref>). Briefly, the forward model for each subject starts with a canonical mesh, defining a lattice of sources on the cortical surface. This mesh is then warped using an inverse spatial normalization so that the canonical mesh is roughly in the same place as the subject's cortical sheet. This means that, after inversion of the ensuing forward model, reconstructed activity can be assigned to the same sources over subjects. One can then project this two-dimensional manifold into a three-dimensional image and proceed in the usual way to make inferences about regionally-specific effects using SPM. However, for this to be efficient, one needs to suppress inter-subject variability in the spatial deployment of reconstructed activity. This can arise from the underdetermined aspect of the inverse problem and calls for formal constraints on single-subject reconstructions. These constraints or hyperpriors are the subject of this technical note.</p>
      </sec>
      <sec>
        <title>Hyperpriors</title>
        <p>The importance of hierarchical or empirical models for single-subject data rests upon optimising not just the parameters of the model (like source activity) but also the priors themselves. This optimisation proceeds under hyperpriors, which can be regarded as priors or constraints on the prior expectations about the pattern of source expression. Critically, the hyperpriors can also be optimised to select the best hyperprior or models (<italic>c.f</italic>., model selection). A simple example of different models would be the distinction between a conventional minimum norm prior and multiple sparse priors. In the former, the prior constraint is that activity has exactly the same variance at every source and, furthermore, is independent. This is encoded by a prior covariance on source space that corresponds to the identity matrix; <italic>i.e</italic>., <italic>Q</italic><sub>1</sub><sup><italic>U</italic></sup> = I. Conversely, in multiple sparse priors the hyperprior is that activity can be expressed in multiple patches or covariance components, <italic>Q</italic><sub>1</sub><sup><italic>U</italic></sup>,…,<italic>Q<sub>m</sub><sup>U</sup></italic>, each of which has an associated hyperparameter (<xref rid="bib6" ref-type="bibr">Friston et al., 2008a</xref>). The difference between minimum norm and multiple sparse prior models rests on the form or number of prior covariance components or, equivalently, the number of hyperparameters. These hyperparameters can be optimised using a variety of techniques. Recently we introduced a modelling approach that is formally identical to restricted maximum likelihood for optimising hundreds of hyperparameters, under multiple sparse priors. The sparse aspect speaks to the fact that many of these prior covariance components are unnecessary or irrelevant and can be switched off (<italic>c.f</italic>., automatic relevance determination; ARD; <xref rid="bib15" ref-type="bibr">Neal, 1998</xref>). This automatic hyperprior or model selection depends on choosing the right objective function (a variational bound on the model's log-evidence that includes weakly informative hyperpriors). An alternative approach to optimising the hyperpriors is to use a greedy search as described in <xref rid="bib7" ref-type="bibr">Friston et al. (2008b)</xref>. The distinction between ARD and greedy search optimisation of models is relatively simple: in ARD one assumes that every hyperparameter has a different value. These hyperparameters are then optimised so that many fall to zero, leaving a small number of relevant or important empirical priors (<xref rid="bib22" ref-type="bibr">Tipping, 2001</xref>). In a greedy search, one starts by assuming all the hyperparameters have the same value and then splits the set of hyperparameters recursively, until the objective function stops increasing (<xref rid="bib7" ref-type="bibr">Friston et al., 2008b</xref>). We will see examples of minimum norm, ARD and greedy search schemes later.</p>
        <p>The particular hyperprior we propose here imposes consistency on the source reconstruction over subjects or sessions. It is a formal constraint that assumes that the prior variance at any particular source in any particular subject can be factorised into a subject-specific and source-specific term. In other words, we assume that the unknown empirical prior variance is proportionally the same over sources but the variance <italic>per se</italic> is scaled in a subject-specific fashion. This simple assumption allows us to estimate source-specific hyperparameters by pooling the data from all trial types and subjects to optimise the form of the prior covariance over sources. This empirical spatial prior then enters a series of single-subject inversions, which optimises the weight afforded to this prior, in relation to subject-specific measurement noise. This formal constraint ensures that the source reconstruction in each individual analysis is confined to the same sources, without biasing the parameter estimates themselves. This means that we can use the parameter estimates as summary-statistics for valid inference at the between-subject level. Note that this does not represent an inversion of a full hierarchical model. Our objective is to finesse the first-level Bayesian inversion to provide useful summary-statistics for classical inference at the second level. By pooling the data to estimate empirical priors on source space, we can meet this objective simply and effectively.</p>
        <p>This paper comprises two sections. In the first, we present the details of the model inversion. This inversion has two stages. The first optimises the empirical prior covariance over subjects. The second entails inverting the data from each subject using the empirical prior from the pooled analysis. We will briefly describe the implicit hierarchical models and the optimisation scheme that we use. In the second section, we will present comparative analyses of between-subject or group-level inference with and without between-subject constraints. We would also take the opportunity to compare the performance of three hyperpriors: a minimum norm hyperprior with a single hyperparameter (this can be regarded as the baseline hyperprior). Second, we will look at multiple sparse priors that have been optimised using ARD. Finally, we will consider the hyperpriors furnished by a greedy search over successive partitions of multiple sparse priors. The formal details concerning these sparse priors will be found in <xref rid="bib6" ref-type="bibr">Friston et al. (2008a)</xref> and the technical details of the greedy search will be found in <xref rid="bib7" ref-type="bibr">Friston et al. (2008b)</xref>. In short, we will compare three hyperprior models of source activity with and without between-subject constraints. The outcome measures we use reflect the quality of each model at the within-subject level and the efficiency of detecting group effects at the between-subject level. The within-subject measure is simply the log-evidence for each of the six (2 × 3) models for each subject (actually five models because the minimum norm is the same with and without constraints — see below). For the between-subject analysis we use two measures based on between-subject SPMs from each of the models. These measures reflect sensitivity (peak <italic>t</italic>-values) and spatial accuracy (location of peaks). The dataset we use involves a simple sensory evoked response following median nerve stimulation. We chose these data because the location of the underlying sources is well known and allows us to interpret our comparative analyses with greater confidence.</p>
      </sec>
    </sec>
    <sec>
      <title>Theory</title>
      <sec>
        <title>Covariance function models</title>
        <p>We start with a hierarchical generative model for data <mml:math id="M1" altimg="si1.gif" overflow="scroll"><mml:mrow><mml:msub><mml:mi>Y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mi mathvariant="fraktur">R</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math> over <italic>c</italic> channels and <italic>n</italic> peristimulus time-bins, from <italic>i </italic>= 1,…,<italic>N</italic> trials or subjects<xref rid="fn1" ref-type="fn">1</xref>. We assume that random effects on the sources factorise onto subject-specific <italic>P</italic>(<italic>ν</italic><sup><italic>P</italic></sup>) and source-specific terms <italic>U</italic>(<italic>ν</italic><sup><italic>U</italic></sup>), such that their covariance is <italic>P</italic> ⊗ <italic>U</italic>. Here, <mml:math id="M2" altimg="si2.gif" overflow="scroll"><mml:mrow><mml:msup><mml:mi>ν</mml:mi><mml:mo>•</mml:mo></mml:msup></mml:mrow></mml:math> are unknown scale parameters that control the covariance or amplitude of random effects in source space. This assumption engenders a probabilistic generative or forward model with empirical (<italic>i.e</italic>., hierarchical) priors on sources <italic>J</italic>. These sources are mapped to channels by subject-specific lead-field or gain matrices, <italic>L</italic><sub>1</sub>,…,<sub><italic>N</italic></sub> to give the following linear model; <italic>Y </italic>= <italic>LJ </italic>+ <italic>ɛ</italic><disp-formula id="fd1"><label>(1)</label><mml:math id="M3" altimg="si3.gif" overflow="scroll"><mml:mrow><mml:mrow><mml:mo stretchy="true">[</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>Y</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>⋮</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>Y</mml:mi><mml:mi>N</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo stretchy="true">]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="true">[</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mtd><mml:mtd><mml:mrow/></mml:mtd><mml:mtd><mml:mrow/></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow/></mml:mtd><mml:mtd><mml:mo>⋱</mml:mo></mml:mtd><mml:mtd><mml:mrow/></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow/></mml:mtd><mml:mtd><mml:mrow/></mml:mtd><mml:mtd><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mi>N</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo stretchy="true">]</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="true">[</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>⋮</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mi>N</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo stretchy="true">]</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mo stretchy="true">[</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>ɛ</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>⋮</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>ɛ</mml:mi><mml:mi>N</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo stretchy="true">]</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>Where, under Gaussian assumptions about random effects,<disp-formula id="fd2"><label>(2)</label><mml:math id="M4" altimg="si4.gif" overflow="scroll"><mml:mtable><mml:mtr><mml:mtd><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mi>Y</mml:mi><mml:mrow><mml:mo stretchy="true">|</mml:mo><mml:mrow><mml:mi>J</mml:mi><mml:mo>,</mml:mo><mml:mi>λ</mml:mi></mml:mrow></mml:mrow></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mi>L</mml:mi><mml:mi>J</mml:mi><mml:mo>,</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>C</mml:mi></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>P</mml:mi><mml:mo>⊗</mml:mo><mml:mi>U</mml:mi></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>λ</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mi>η</mml:mi><mml:mo>,</mml:mo><mml:mi>R</mml:mi></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow/></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>C</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="italic">diag</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msubsup><mml:mi>ν</mml:mi><mml:mn>1</mml:mn><mml:mi>C</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>ν</mml:mi><mml:mi>N</mml:mi><mml:mi>C</mml:mi></mml:msubsup></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>⊗</mml:mo><mml:msup><mml:mi>Q</mml:mi><mml:mi>C</mml:mi></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>U</mml:mi><mml:mo>=</mml:mo><mml:msubsup><mml:mi>ν</mml:mi><mml:mn>1</mml:mn><mml:mi>U</mml:mi></mml:msubsup><mml:msubsup><mml:mi>Q</mml:mi><mml:mn>1</mml:mn><mml:mi>U</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:mo>…</mml:mo><mml:mo>+</mml:mo><mml:msubsup><mml:mi>ν</mml:mi><mml:mi>M</mml:mi><mml:mi>U</mml:mi></mml:msubsup><mml:msubsup><mml:mi>Q</mml:mi><mml:mi>M</mml:mi><mml:mi>U</mml:mi></mml:msubsup></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>P</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="italic">diag</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msubsup><mml:mi>ν</mml:mi><mml:mn>1</mml:mn><mml:mi>P</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>ν</mml:mi><mml:mi>N</mml:mi><mml:mi>P</mml:mi></mml:msubsup></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>ν</mml:mi><mml:mo>=</mml:mo><mml:mtext>exp</mml:mtext><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>λ</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>Here, <italic>p</italic>(<italic>ɛ</italic>) = <italic>N</italic>(0,<italic>V</italic>,<italic>C</italic>) denotes a zero-mean Gaussian density on a matrix with temporal correlations, <italic>V</italic> and spatial covariances among channels, <italic>C</italic>. In this model, <italic>Q</italic><sup><italic>C</italic></sup> represents a single covariance component over channels, which is scaled by a subject-specific covariance parameter or hyperparameter <italic>ν<sub>i</sub><sup>C</sup></italic> to give the covariance of channel noise<xref rid="fn2" ref-type="fn">2</xref>. Similarly, Q<italic><sub>j</sub><sup>U</sup></italic> represent covariance components in source space that are scaled by <italic>ν<sub>i</sub><sup>P</sup>ν<sub>j</sub><sup>U</sup></italic> to give the contribution of the <italic>j</italic>-th component to the <italic>i</italic>-th subject's source activity. This scaling by a product of two scale parameters embodies the formal hyperprior that source activity factorises into source and subject-specific components.</p>
        <p>Note that the unknown hyperparameters <mml:math id="M5" altimg="si5.gif" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>λ</mml:mi><mml:mi>i</mml:mi><mml:mo>•</mml:mo></mml:msubsup><mml:mo>=</mml:mo><mml:mi>ln</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msubsup><mml:mi>ν</mml:mi><mml:mi>i</mml:mi><mml:mo>•</mml:mo></mml:msubsup></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:math> have their own prior densities, <mml:math id="M6" altimg="si6.gif" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msubsup><mml:mi>λ</mml:mi><mml:mi>i</mml:mi><mml:mo>•</mml:mo></mml:msubsup></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:math>, which place non-negative lognormal hyperpriors on the corresponding scale parameters <mml:math id="M7" altimg="si7.gif" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>ν</mml:mi><mml:mi>i</mml:mi><mml:mo>•</mml:mo></mml:msubsup></mml:mrow></mml:math>. In what follows, we assume that <italic>V</italic> is a fixed Gaussian autocorrelation matrix with a smoothness that corresponds to any filtering applied during pre-processing. We will also assume that <italic>Q<sup>C</sup> </italic>= <italic>I</italic> and select the source components <italic>Q</italic><sub>1</sub><sup><italic>U</italic></sup>,…,<italic>Q<sub>M</sub><sup>U</sup></italic> according to the model <italic>m</italic> required (<italic>e.g</italic>., multiple sparse priors, minimum norm <italic>etc</italic>.). We use weakly informative hyperpriors with <italic>η </italic>= − 16 and <italic>R </italic>= 32<italic>I</italic> that tend to eliminate unnecessary components.</p>
        <sec>
          <title>Gaussian process models</title>
          <p>This model may look complicated but it can be reduced to a very simple form, which is easy to invert. This form is a Gaussian process or covariance function model, which effectively expresses the expected sample covariance of the data as a covariance function of the hyperparameters. Note that in this form, the parameters are eliminated and we have only to optimise the hyperparameters. For a single subject, the sample covariance of spatiotemporally ‘normalised’ responses <italic>S(Y˜<sub>i</sub></italic>) and its expectation Σ˜(<italic>λ<sub>i</sub></italic>) are<disp-formula id="fd3"><label>(3)</label><mml:math id="M8" altimg="si8.gif" overflow="scroll"><mml:mtable><mml:mtr><mml:mtd><mml:mi>S</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:msub><mml:mrow><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:msup><mml:mi>V</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi><mml:mi>T</mml:mi></mml:msubsup></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow/></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="normal">Σ</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msub><mml:mi>λ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msubsup><mml:mi>ν</mml:mi><mml:mi>i</mml:mi><mml:mi>P</mml:mi></mml:msubsup><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msubsup><mml:mi>ν</mml:mi><mml:mn>1</mml:mn><mml:mi>U</mml:mi></mml:msubsup><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>Q</mml:mi><mml:mo mathvariant="bold">˜</mml:mo></mml:mover></mml:mrow><mml:mn>1</mml:mn><mml:mi>U</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:mo>…</mml:mo><mml:mo>+</mml:mo><mml:msubsup><mml:mi>ν</mml:mi><mml:mi>M</mml:mi><mml:mi>U</mml:mi></mml:msubsup><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>Q</mml:mi><mml:mo mathvariant="bold">˜</mml:mo></mml:mover></mml:mrow><mml:mi>M</mml:mi><mml:mi>U</mml:mi></mml:msubsup></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msubsup><mml:mi>ν</mml:mi><mml:mi>i</mml:mi><mml:mi>C</mml:mi></mml:msubsup><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>Q</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi><mml:mi>C</mml:mi></mml:msubsup></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>Q</mml:mi><mml:mo mathvariant="bold">˜</mml:mo></mml:mover></mml:mrow><mml:mi>k</mml:mi><mml:mi>U</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mi mathvariant="italic">GQ</mml:mi><mml:mi>k</mml:mi><mml:mi>U</mml:mi></mml:msubsup><mml:msup><mml:mi>G</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>Q</mml:mi><mml:mo mathvariant="bold">˜</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi><mml:mi>C</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msup><mml:mi>Q</mml:mi><mml:mi>C</mml:mi></mml:msup><mml:msubsup><mml:mi>A</mml:mi><mml:mi>i</mml:mi><mml:mi>T</mml:mi></mml:msubsup></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>Essentially, this says that that the predicted covariance of normalised channel data, <mml:math id="M9" altimg="si9.gif" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>Y</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math> over time, is a mixture of covariance components from source space and measurement space. The normalization matrix <italic>A</italic><sub><italic>i</italic></sub> = <italic>GL</italic><sub><italic>i</italic></sub><sup><italic>T</italic></sup>(<italic>L</italic><sub><italic>i</italic></sub><italic>L</italic><sub><italic>i</italic></sub><sup><italic>T</italic></sup>)<sup>− 1</sup> ⇐ <italic>A</italic><sub><italic>i</italic></sub><italic>L</italic><sub><italic>i</italic></sub> = <italic>G</italic> effectively re-samples the channel data to return what would have been observed if the gain-matrix was an arbitrary matrix, <italic>G</italic>. We usually use the gain-matrix from the first subject; <italic>i.e</italic>., <italic>G</italic> = <italic>L</italic><sub>1</sub>. This re-sampling is useful because it allows us to specify a covariance function model for the sample covariance over subjects<disp-formula id="fd4"><label>(4)</label><mml:math id="M10" altimg="si10.gif" overflow="scroll"><mml:mtable><mml:mtr><mml:mtd><mml:mi>S</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:mrow><mml:mi>S</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow/></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="normal">Σ</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msub><mml:mi>λ</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>ν</mml:mi><mml:mo>―</mml:mo></mml:mover></mml:mrow><mml:mn>1</mml:mn><mml:mi>U</mml:mi></mml:msubsup><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>Q</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mn>1</mml:mn><mml:mi>U</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:mo>…</mml:mo><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>ν</mml:mi><mml:mo>―</mml:mo></mml:mover></mml:mrow><mml:mi>M</mml:mi><mml:mi>U</mml:mi></mml:msubsup><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>Q</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mi>M</mml:mi><mml:mi>U</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>ν</mml:mi><mml:mn>1</mml:mn><mml:mi>C</mml:mi></mml:msubsup><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>Q</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mn>1</mml:mn><mml:mi>U</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:mo>…</mml:mo><mml:mo>+</mml:mo><mml:msubsup><mml:mi>ν</mml:mi><mml:mi>N</mml:mi><mml:mi>C</mml:mi></mml:msubsup><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>Q</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mi>N</mml:mi><mml:mi>U</mml:mi></mml:msubsup></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>ν</mml:mi><mml:mo>―</mml:mo></mml:mover></mml:mrow><mml:mi>k</mml:mi><mml:mi>U</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mover accent="true"><mml:mi>ν</mml:mi><mml:mo>―</mml:mo></mml:mover></mml:mrow><mml:mi>P</mml:mi></mml:msup><mml:msubsup><mml:mi>ν</mml:mi><mml:mi>k</mml:mi><mml:mi>U</mml:mi></mml:msubsup></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msup><mml:mrow><mml:mover accent="true"><mml:mi>ν</mml:mi><mml:mo>―</mml:mo></mml:mover></mml:mrow><mml:mi>P</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:msubsup><mml:mi>ν</mml:mi><mml:mn>1</mml:mn><mml:mi>P</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:mo>…</mml:mo><mml:mo>+</mml:mo><mml:msubsup><mml:mi>ν</mml:mi><mml:mi>N</mml:mi><mml:mi>P</mml:mi></mml:msubsup></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>Again, the covariance function Σ˜(<italic>λ</italic>) is a mixture of components from source and measurement space; these are a mixture of <italic>M</italic> source-specific spatial components and <italic>N</italic> subject-specific sensor-noise components. In this model, the hyperparameters <mml:math id="M11" altimg="si11.gif" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>λ</mml:mi><mml:mi>k</mml:mi><mml:mi>U</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mi>ln</mml:mi><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>ν</mml:mi><mml:mo>―</mml:mo></mml:mover></mml:mrow><mml:mi>k</mml:mi><mml:mi>U</mml:mi></mml:msubsup></mml:mrow></mml:math> encoding contributions from source space are the same over subjects; it is these we seek to provide an empirical prior on source space that is conserved over subjects. We now have a Gaussian process model for a group of subjects that is easy to invert or optimise.</p>
        </sec>
        <sec>
          <title>Optimising Gaussian process models</title>
          <p>Covariance function formulations of linear models are important because their hyperparameters can be optimised using standard covariance component estimation techniques to maximise the model evidence, <italic>p</italic>(<italic>Y</italic>|<italic>m</italic>) for any data <italic>Y</italic> under model <italic>m</italic><xref rid="fn3" ref-type="fn">3</xref>. Once the hyperparameters have been optimised the conditional density of the parameters is easy to compute, either for the group average or each subject (see below). In this context, optimisation uses an augmented restricted maximum likelihood scheme (<xref rid="bib8" ref-type="bibr">Harville, 1977</xref>), as described in <xref rid="bib5" ref-type="bibr">Friston et al. (2007)</xref>. This scheme is formally equivalent to a variational inversion under the mean-field assumption that the conditional density <italic>q</italic>(<italic>J</italic>,<italic>λ</italic>) = <italic>q</italic>(<italic>J</italic>)<italic>q</italic>(<italic>λ</italic>) factorises into Gaussian marginals. Here, <italic>q</italic>(<italic>J</italic>) = <italic>N</italic>(<italic>μ</italic><sup><italic>J</italic></sup>,Σ<sup><italic>J</italic></sup>), where <italic>μ</italic><sup><italic>J</italic></sup> and Σ<sup><italic>J</italic></sup> are the conditional expectation and covariance of parameters; similarly for the hyperparameters, <italic>q</italic>(<italic>λ</italic>) = <italic>N</italic>(<italic>μ</italic><sup><italic>λ</italic></sup>,Σ<sup><italic>λ</italic></sup>). Under this Gaussian or Laplace assumption, the hyperparameters of any Gaussian process model maximise a variational free-energy bound on the log-evidence<xref rid="fn4" ref-type="fn">4</xref><disp-formula id="fd5"><label>(5)</label><mml:math id="M12" altimg="si12.gif" overflow="scroll"><mml:mrow><mml:mi>F</mml:mi><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mi>D</mml:mi><mml:mn>2</mml:mn></mml:mfrac><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msup><mml:mi mathvariant="normal">Σ</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi>S</mml:mi></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mi>D</mml:mi><mml:mn>2</mml:mn></mml:mfrac><mml:mi>ln</mml:mi><mml:mrow><mml:mo stretchy="true">|</mml:mo><mml:mi mathvariant="normal">Σ</mml:mi><mml:mo stretchy="true">|</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mi>ln</mml:mi><mml:mrow><mml:mo stretchy="true">|</mml:mo><mml:mrow><mml:msup><mml:mi mathvariant="normal">Σ</mml:mi><mml:mi>λ</mml:mi></mml:msup><mml:mi mathvariant="normal">Π</mml:mi></mml:mrow><mml:mo stretchy="true">|</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msup><mml:mi>μ</mml:mi><mml:mi>λ</mml:mi></mml:msup><mml:mo>−</mml:mo><mml:mi>η</mml:mi></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:mi mathvariant="normal">Π</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msup><mml:mi>μ</mml:mi><mml:mi>λ</mml:mi></mml:msup><mml:mo>−</mml:mo><mml:mi>η</mml:mi></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>Where, <italic>D</italic> represents the total number of samples used to evaluate the sample covariance matrix<xref rid="fn5" ref-type="fn">5</xref> and π = <italic>R</italic><sup>-1</sup> is the prior precision of the hyperparameters from <xref rid="fd2" ref-type="disp-formula">Eq. (2</xref>). This bound is a function of sample and predicted covariances, <italic>S</italic>(<italic>Y</italic>) and Σ(<italic>μ</italic><sup><italic>λ</italic></sup>) respectively. Optimisation is relatively simple and involves iterating<disp-formula id="fd6"><label>(6)</label><mml:math id="M13" altimg="si13.gif" overflow="scroll"><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mi>F</mml:mi><mml:mrow><mml:mi>λ</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mi>D</mml:mi><mml:mn>2</mml:mn></mml:mfrac><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mi>S</mml:mi><mml:mo>−</mml:mo><mml:mi mathvariant="normal">Σ</mml:mi></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi mathvariant="normal">Π</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>i</mml:mi><mml:mi>λ</mml:mi></mml:msubsup><mml:mo>−</mml:mo><mml:msub><mml:mi>η</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mi>F</mml:mi><mml:mrow><mml:mi>λ</mml:mi><mml:mi>λ</mml:mi><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mi>D</mml:mi><mml:mn>2</mml:mn></mml:mfrac><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mi mathvariant="normal">Σ</mml:mi><mml:msub><mml:mi>P</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mi mathvariant="normal">Σ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi mathvariant="normal">Π</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow/></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi mathvariant="italic">Δ</mml:mi><mml:msup><mml:mi>μ</mml:mi><mml:mi>λ</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:msubsup><mml:mi>F</mml:mi><mml:mrow><mml:mi>λ</mml:mi><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:msub><mml:mi>F</mml:mi><mml:mi>λ</mml:mi></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msup><mml:mi mathvariant="normal">Σ</mml:mi><mml:mi>λ</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:msubsup><mml:mi>F</mml:mi><mml:mrow><mml:mi>λ</mml:mi><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>until convergence. The matrix <italic>P</italic><sub><italic>i</italic></sub> is the derivative of the precision, Σ(<italic>μ</italic><sup><italic>λ</italic></sup>)<sup>− 1</sup> with respect to the <italic>i</italic>-th hyperparameter. <italic>F</italic><sub><italic>λ</italic></sub> and <italic>F</italic><sub><italic>λλ</italic></sub> are the gradient and expected curvature of the free-energy. Note that this scheme deals with relatively small <italic>c</italic> × <italic>c</italic> matrices whose size corresponds to the number of channels. In other words, computational load does not scale with the number of time-bins, trials or subjects.</p>
          <p>Put simply, this procedure optimises the amount of each covariance component iteratively, to minimise the difference between the sample covariance and the ensuing mixture of components. The difference is essentially the Kullback-Leibler divergence between the sample and predicted Gaussian densities encoded by the covariances (<xref rid="bib8" ref-type="bibr">Harville, 1977</xref>).</p>
        </sec>
      </sec>
      <sec>
        <title>A two-stage optimisation</title>
        <p>The hyperparameters of our hierarchical model can be optimised in two stages. First, we estimate the hyperparameters of Σ˜(λ), using the sample covariance over subjects S (<italic>Y</italic>˜) to furnish the conditional estimates of source-specific scale parameters, <mml:math id="M14" altimg="si14.gif" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>ν</mml:mi><mml:mo>―</mml:mo></mml:mover></mml:mrow><mml:mn>1</mml:mn><mml:mi>U</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>ν</mml:mi><mml:mo>―</mml:mo></mml:mover></mml:mrow><mml:mi>M</mml:mi><mml:mi>U</mml:mi></mml:msubsup></mml:mrow></mml:math>. These define an empirical prior covariance on the sources <mml:math id="M15" altimg="si15.gif" overflow="scroll"><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>―</mml:mo></mml:mover></mml:mrow><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>ν</mml:mi><mml:mo>―</mml:mo></mml:mover></mml:mrow><mml:mn>1</mml:mn><mml:mi>U</mml:mi></mml:msubsup><mml:msubsup><mml:mi>Q</mml:mi><mml:mn>1</mml:mn><mml:mi>U</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:mo>…</mml:mo><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>ν</mml:mi><mml:mo>―</mml:mo></mml:mover></mml:mrow><mml:mi>M</mml:mi><mml:mi>U</mml:mi></mml:msubsup><mml:msubsup><mml:mi>Q</mml:mi><mml:mi>M</mml:mi><mml:mi>U</mml:mi></mml:msubsup></mml:mrow></mml:math> that is common to all subjects (to within a scaling factor). Second, we optimise subject-specific hyperparameters using the sample covariance of single-subject data <italic>S</italic>(<italic>Y</italic><sub><italic>i</italic></sub>) and the covariance function model<disp-formula id="fd7"><label>(7)</label><mml:math id="M16" altimg="si16.gif" overflow="scroll"><mml:mrow><mml:msub><mml:mi mathvariant="normal">Σ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>λ</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msubsup><mml:mi>ν</mml:mi><mml:mi>i</mml:mi><mml:mi>P</mml:mi></mml:msubsup><mml:msub><mml:mi>L</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>―</mml:mo></mml:mover></mml:mrow><mml:msubsup><mml:mi>L</mml:mi><mml:mi>i</mml:mi><mml:mi>T</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>ν</mml:mi><mml:mi>i</mml:mi><mml:mi>C</mml:mi></mml:msubsup><mml:msup><mml:mi>Q</mml:mi><mml:mi>C</mml:mi></mml:msup></mml:mrow></mml:math></disp-formula>Here, the only unknowns are the subject-specific error covariance and source-prior hyperparameters. These are optimised in exactly the same way as above to give the conditional estimates of <italic>λ<sub>i</sub> </italic>= {<italic>ν<sub>i</sub><sup>P</sup></italic>,ν<italic><sub>i</sub><sup>C</sup></italic>}. These specify the <italic>maximum a-posterior</italic> (<italic>MAP</italic>) estimates of source activity using the matrix inversion lemma.<disp-formula id="fd8"><label>(8)</label><mml:math id="M17" altimg="si17.gif" overflow="scroll"><mml:mtable><mml:mtr><mml:mtd><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>i</mml:mi><mml:mi>J</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>Y</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msubsup><mml:mi mathvariant="normal">Σ</mml:mi><mml:mi>i</mml:mi><mml:mi>J</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>U</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>L</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>U</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mtext>.</mml:mtext></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula></p>
        <p><italic>M<sub>i</sub> </italic>= <italic>U</italic><sub><italic>i</italic></sub><italic>L<sub>i</sub><sup>T</sup></italic>Σ<sub><italic>i</italic></sub><sup>-1</sup> is a <italic>MAP</italic> projector, where the covariance function Σ<sub><italic>i</italic></sub>(<italic>λ</italic>) and empirical prior covariance <mml:math id="M18" altimg="si18.gif" overflow="scroll"><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msub><mml:mi>λ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msubsup><mml:mi>ν</mml:mi><mml:mi>i</mml:mi><mml:mi>P</mml:mi></mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>―</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:math> are evaluated at the conditional modes of <italic>λ</italic><sub><italic>i</italic></sub>.</p>
        <p>Time–frequency contrasts of these subject and trial-specific source reconstructions can then be used to summarise the subject-specific responses to each trial type. These contrasts generally test for specific time–frequency components by defining a temporal subspace of interest (<italic>e.g</italic>., gamma oscillations between 300 and 400 ms after stimulus onset). The contrast matrix can be a simple vector; for example a Gaussian window <mml:math id="M19" altimg="si19.gif" overflow="scroll"><mml:mrow><mml:mi>W</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="fraktur">R</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math> over a short period of peristimulus time or cover specified frequency ranges (with one frequency per column) over extended periods of peristimulus time (<xref rid="bib11" ref-type="bibr">Kiebel and Friston, 2004</xref>). The conditional expectation of the energy in a contrast is<disp-formula id="fd9"><label>(9)</label><mml:math id="M20" altimg="si20.gif" overflow="scroll"><mml:mrow><mml:mi>E</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mi>W</mml:mi><mml:msup><mml:mi>W</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:msubsup><mml:mi>J</mml:mi><mml:mi>i</mml:mi><mml:mi>T</mml:mi></mml:msubsup></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>Y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mi>W</mml:mi><mml:msup><mml:mi>W</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:msubsup><mml:mi>Y</mml:mi><mml:mi>i</mml:mi><mml:mi>T</mml:mi></mml:msubsup><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>M</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi><mml:mi>T</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi mathvariant="normal">Σ</mml:mi><mml:mi>i</mml:mi><mml:mi>J</mml:mi></mml:msubsup><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msup><mml:mi>W</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mi>V</mml:mi><mml:mi>W</mml:mi></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>See <xref rid="bib4" ref-type="bibr">Friston et al. (2006)</xref> for details. The conditional estimates of contrast energy can then be used as summaries of condition-specific responses for each subject and entered into statistical models of between-subject responses in the usual way. <xref rid="fd9" ref-type="disp-formula">Eq. (9</xref>) provides more accurate estimates than classical beam-forming approaches because uncertainty about the activity enters the estimate of power or energy in a contrast. In other words, the expected energy is not just the energy of expected activity (as assumed in beam-forming) but involves an extra term that accounts for variability in the expected activity (the second term above). In the next section, we will use the equations above to estimate summary-statistics for evoked responses using a series of different models that are defined by the prior covariance components employed.</p>
      </sec>
      <sec>
        <title>Prior covariance components</title>
        <p>For the minimum norm model there is only one prior covariance component that corresponds to the identity matrix, Q<sub>1</sub><italic><sup>U</sup> </italic>= <italic>I</italic>. In this simplest case, the between-subject constraint should make no difference to the within-subject estimates of activity. However, for the ARD and greedy search schemes, which use multiple prior components, the effects of between-subject constraints could be quite profound. The multiple sparse priors we use in this paper are described in <xref rid="bib6" ref-type="bibr">Friston et al. (2008a)</xref> Briefly, they comprise 256 small patches with compact spatial support in each hemisphere and a further 256 components corresponding to a bilateral deployment of homologous patches. Each patch is formed by diffusing a point source on the cortical mesh, using a graph Laplacian with a diffusion coefficient of 0.6. This coefficient is basically a smoothness parameter and can vary between zero and one. In practice, we do not use the data from all peristimulus times but project the responses onto a temporal subspace using a modified Kaiser criterion. This subspace is defined by singular value decomposition of the temporal responses over trials and subjects. This usually identified about four to eight temporal modes that span more than 95% of the data variance. This temporal subspace also precludes frequencies lower than 1 Hz and higher than 64 Hz. This concludes the theoretical background. In the next section, we evaluate the between-subject constraint under the three different hyperprior models detailed above.</p>
      </sec>
    </sec>
    <sec>
      <title>Comparative analyses</title>
      <p>In this section, we present comparative analyses of the source reconstructions at the within and between-subject level. Data were acquired as a part of previously published study (<xref rid="bib12" ref-type="bibr">Litvak et al., 2007</xref>). The original study examined the effect of combined somatosensory and transcranial magnetic stimulation (TMS) on median nerve somatosensory evoked potentials (MN-SSEP). The MN-SSEP were recorded before and after TMS. Each of eleven healthy volunteers (eight men and three women), aged 20.9 to 44.5 (mean 26.3 ± 7.2 years) participated in five experiments, which differed in the TMS parameters. For the present analysis, we use only MN-SSEP recorded before TMS. Thus, our dataset consisted of five MN-SSEP recordings per subject.</p>
      <sec>
        <title>Data acquisition and pre-processing</title>
        <p>The recordings were performed under identical conditions with intervals of several days to one year between sessions. Median nerve stimulation was performed using an electrical stimulator (Digitimer D7AH, Digitimer, Welwyn Garden, Hertfordshire, UK) with a standard stimulation block (cathode proximal), pulse width 200 μs at a frequency of 3 Hz and a stimulation intensity of 300% of the individual perceptual threshold. Eighteen hundred stimuli were delivered. Electroencephalographic (EEG) signals were recorded from the scalp with a 64-channel Quickamp system (Brain Products GmbH, Munich, Germany). The electrodes were placed at extended 10–20 system locations and fixed on the subject's head with an elastic cap (EASYCAP GmbH, Herrsching-Breitbrunn, Germany). The electrode impedance was maintained below 5 kΩ. Electrode positions and anatomic reference points were measured for each experiment with a 3D navigation system (Brainsight, Rogue research, Montreal, Canada). The brain signals were average referenced in hardware, filtered between 0 and 560 Hz and sampled at 2000 Hz.</p>
        <p>The data were processed with the SPM software package (<ext-link xlink:href="http://www.fil.ion.ucl.ac.uk/spm" ext-link-type="uri">http://www.fil.ion.ucl.ac.uk/spm</ext-link>). The continuous EEG data were high-pass filtered (above a cut-off frequency 20 Hz) and epoched between − 50 and 50 ms relative to the median nerve stimulus. Trials were rejected if they contained deflections exceeding 50 μV. Channels were marked as bad if they contained such deflections in more than 20% of the trials. The number of trials retained for analysis was 1545 ± 242. No channels were excluded in 34 out of 55 experiments, 1 channel in 12 cases, 2 channels in 5 cases, 3 channels in 2 cases and 6 channels in 2 cases. Retained trials were averaged to obtain MN-SSEP waveforms and used, in combination with measured positions of the retained sensors and the fiducials, as input for SPM source reconstruction.</p>
        <p>We chose this dataset for the present study for two reasons. The first is that MN-SSEP sources have been studied extensively with invasive and non-invasive recordings in humans and animals; they are known to reside in the hand area of the primary somatosensory cortex (S1), principally in Brodmann area 3b, which is located at the posterior wall of the central sulcus; with a weaker and slightly delayed source in adjacent Brodmann area 1, which is located on the top of the postcentral gyrus (<xref rid="bib1" ref-type="bibr">Allison et al., 1991</xref>). The second reason is that this particular dataset is especially suitable for testing source reconstruction with group constraints. By selecting one of the five experiments from each of the eleven subjects, 5<sup>11</sup> different group MN-SSEP datasets can be formed. Ideally, source reconstructions and statistical tests performed on these group-data should yield consistent results. By looking at how variable the results are, under different hyperpriors, the utility of these models can be assessed. In what follows, an ‘experiment’ means a single recoding session subtending a subject-specific MN-SSEP and ‘group’ refers to collection of experiments from eleven different subjects.</p>
      </sec>
      <sec>
        <title>Source reconstruction</title>
        <p>The somatosensory evoked activity was reconstructed from 10 to 40 ms after stimulation. This reconstruction proceeded under the three hyperprior models: minimum norm (MN), multiple sparse priors optimised with ARD and multiple sparse prior partitions optimised with a greedy search (GS). Note that the ARD and GS implicitly optimise both the empirical priors and the model itself. This is because when a prior component is switched on or off, the form of the model changes. Conversely, minimum norm reconstructions with and without group constraints are identical. Thus ARD and GS reconstruction schemes were repeated with and without the formal constraint that imposes the same empirical spatial prior over subjects. In total, we examined five source reconstruction schemes: MN, ARD, GS, ARD with group constraints (gARD) and GS with group constraints (gGS).</p>
        <p>Reconstruction without group constraints was performed once for each experiment and each hyperprior model. For reconstruction with group constraints, 100 groups of experiments (each with <italic>N </italic>= 11 subjects) were randomly sampled from the 5<sup>11</sup> possible groups. Thus, each experiment was used in approximately one fifth of group reconstructions (<italic>i.e</italic>., ∼ 20 reconstructions per hyperprior model). The same 100 groups were used for all reconstruction schemes and <italic>t</italic>-tests (see below). The reconstructions with and without group constraints used exactly the same two-stage procedure but the unconstrained reconstruction used only one subject per group (our software implementation uses just one routine that can be called with one or more subjects). Critically, this means that the final reconstruction (stage 2; in <xref rid="fig1" ref-type="fig">Fig. 1</xref>) used just two covariance components (an empirical source prior and sensor noise). This means that models, with and without constraints had the same number of unknown parameters and hyperparameters.</p>
        <sec>
          <title>Model comparison at the within-subject level</title>
          <p>The reconstructed activities per experiment were summarized with a Gaussian time-window centred at 20 ms (with a standard deviation of 8 ms), which is about the time the maximum sensory evoked response is expressed in somatosensory cortex. For each reconstruction, we recorded the free-energy bound on log-evidence (<italic>F</italic>). In the case of reconstructions with group constraints, the values of <italic>F</italic> for each experiment were averaged over all reconstructions in which that experiment was used. The log-evidence provides a measure of the model quality that accommodates both accuracy and complexity (<italic>i.e</italic>., number of priors). Critically, it pertains to the ability of models to explain the data from each experiment but does not reflect those models' generalisability over different datasets. We expected that ARD and GS schemes would provide much better explanations of data, relative to the rather unlikely priors entailed by the MN model. Furthermore, we anticipated that the group constants would <italic>reduce</italic> the log-evidence for ARD and GS, because they constrain the optimisation of subject-specific parameters, when trying to explain a particular experiment. In other words, the advantage of group constraints should only be evident at the between-subject or group level and may even compromise the optimisation at the within-subject or experiment level.</p>
          <p>We were interested in relative, rather than absolute values of the free-energy and primarily in the comparison between the GS and ARD schemes, with and without group constraints. Therefore, we analysed the differences between the <italic>F</italic>-values for minimum norm and for the other four schemes for each experiment. We also subjected the <italic>F</italic>-values obtained with GS and ARD to an ANOVA with two factors (hyperprior model; ARD <italic>vs.</italic> GS and between-subject constraint; with <italic>vs</italic>. without). This allowed us to assess the overall effect of different models, group constraints and how the model-effect depends on group constraints.</p>
        </sec>
        <sec>
          <title>Model comparison at the between-subject level</title>
          <p>To assess the quality of reconstructed source activity we performed paired samples <italic>t</italic>-tests using conventional statistical parametric mapping (SPM) procedures to compare the original contrast images and the same images flipped across the midsagittal plane. This is a device to assess the lateralisation of responses evoked by unilateral median nerve stimulation. The contrast images were constructed after diffusion on the canonical mesh and projection into three-dimensional anatomical space.</p>
          <p>For each reconstruction scheme 100 <italic>t</italic>-tests were performed using the 100 group-datasets. The statistical images produced by SPM were assessed with respect to two criteria: the maximal <italic>t</italic>-value in each SPM and the distance of this maximum from the maximum in the average SPM, over the 100 replications of the same reconstruction scheme (we will refer to this as the mean location). These two measures, the height of the maximum <italic>t</italic>-value and its distance from the mean location, quantify the sensitivity of the between-subject analysis and its spatial precision. We anticipated that the best model would co-localise reconstructed activity in a consistent way over subjects and produce the largest <italic>t</italic>-values with the least dispersion across repetitions in unilateral somatosensory cortex. To exploit the fact that we had 100 realisations of group data, we present the distribution of these two metrics in terms of their cumulative sample density.</p>
        </sec>
      </sec>
    </sec>
    <sec>
      <title>Results</title>
      <sec>
        <title>Model comparison at the within-subject level</title>
        <p>As expected, the log-evidence for the reconstruction schemes using multiple sparse priors, significantly exceeded the evidence for conventional minimum norm models (mean difference ± SEM GS: 85.4 ± 7.8, ARD: 47.0 ± 7.4, gGS: 56.0 ± 6.4, gARD: 64.2 ± 6.8; <xref rid="fig2" ref-type="fig">Fig. 2</xref>A). An analysis of variance of the log-evidences from the experiment-specific inversions showed a significant cross-over interaction between the model and the effect of group constraints (<italic>F</italic><sub>(1, 54)</sub> = 258.78, <italic>p</italic> &lt; 0.001). For GS <italic>F</italic> was significantly higher without group constraints (<italic>p</italic> &lt; 0.001) whereas for ARD, <italic>F</italic> was higher with group constraints (<italic>p</italic> &lt; 0.001) (<xref rid="fig2" ref-type="fig">Fig. 2</xref>B). On average, the model with the largest evidence was returned by the greedy search without group constraints. For the GS models, this is exactly what we had expected, in that the group constraints compromise the optimisation of the parameters and hyperparameters, in relation to any one dataset. Furthermore, in the absence of group constraints, the superiority of the greedy search over the ARD was not surprising, in that the ARD model is very over parameterised and can easily get stuck in local maxima (see <xref rid="bib24" ref-type="bibr">Wipf and Nagarajan, in press</xref> for an analysis of convexity of these sorts of objective functions).</p>
        <p>What was surprising is the fact that group constraints <italic>improved the evidence for ARD models</italic>. Strictly speaking, this is impossible because any empirical source priors, furnished by group constraints, should have been discovered during the ARD. The only explanation is that ARD finds local maxima in its very high-dimensional search space and that these local maxima are suppressed by group constraints. In other words, the group constraints remove local maxima and allow the ARD scheme to find better solutions. This is encouraging because it means the group constraints must be partly veridical; if they are not, there would have been no improvement in the evidence for ARD models.</p>
        <p>Finally, the interaction between model and group constraints makes sense from this perspective; in that ARD benefits much more from constraints than the GS, because it has a much higher dimensional search space to navigate. We were slightly surprised that ARD outperformed GS with group constraints, given our anecdotal experience with these schemes. However, it may be the case that the focal responses evoked by median nerve stimulation do not require the models of distributed responses afforded by the partitions (sets of ARD priors) optimised during the greedy search.</p>
      </sec>
      <sec>
        <title>Model comparison at the between-subject level</title>
        <p>Five one-sample <italic>t</italic>-test SPMs testing for a sensory evoked response from one of the randomly selected groups are shown in <xref rid="fig3" ref-type="fig">Fig. 3</xref>. These illustrate the similarities and differences across the five reconstruction schemes we evaluated. <xref rid="fig4" ref-type="fig">Fig. 4</xref> shows the cumulative distributions of maximal <italic>t</italic>-values (4A) and the distribution of distance of the voxel with the maximal t-value from the mean location for the same reconstruction scheme (4B).</p>
        <p>Interestingly, on average, the maximum <italic>t</italic>-values for the ARD and GS schemes were lower than for minimum norm, but for GS with group constraints the difference was not significant (GS: <italic>p</italic> &lt; 0.001, ARD: <italic>p</italic> &lt; 0.001, GS group: <italic>p</italic> = 0.07, ARD group: <italic>p</italic> = 0.001). Repeated measures two-way ANOVA<xref rid="fn6" ref-type="fn">6</xref> showed no interaction between the hyperprior model and the effect of group constraints (<italic>F</italic><sub>(1, 99)</sub> = 0.52, <italic>p</italic> = 0.47). Main effects of both factors were significant (hyperprior type: <italic>F</italic><sub>(1, 99)</sub> = 7.78, <italic>p</italic> = 0.006, group constraints: <italic>F</italic><sub>(1, 99)</sub> = 512.5, <italic>p</italic> &lt; 0.001). Maximal <italic>t</italic>-values were higher for GS, than for ARD and higher with group constraints, than without. The highest <italic>t</italic>-values (except for minimum norm) were attained with GS with group constraints. However, the difference between GS with group constraints and ARD with group constraints was not significant (<italic>p</italic> = 0.29).</p>
        <p>It might seem paradoxical for the minimum norm solutions to yield the highest <italic>t</italic>-values, given their models had the lowest evidence on a per subject basis. The reason for this is that the MN solutions deploy reconstructed activity in a non-focal fashion, with very little spatial specificity. This is evident when we consider the evaluation of spatial precision: The dispersion of maxima under GS (<italic>p</italic> &lt; 0.001), gGS (<italic>p</italic> &lt; 0.001) and gARD (<italic>p</italic> &lt; 0.001) was much smaller than for minimum norm models. ARD without group constraints was not significantly different from minimum norm, with respect to this measure (<italic>p</italic> = 0.55). The cumulative densities in <xref rid="fig4" ref-type="fig">Fig. 4</xref>B shows that 50% of the SPMs obtained with GS under group constraints furnished a maximum within about 10 mm of the mean location. This contrasts with the MN solutions, where 50% of maxima were only within about 30 mm of their mean location. ANOVA showed a significant interaction between the model and the effect of group constraints (<italic>F</italic><sub>(1, 99)</sub> = 42.01, <italic>p</italic> &lt; 0.001). For GS there was no significant effect of the group constraints on dispersion (<italic>p</italic> = 0.6). For ARD, however, the effect of group constraints was highly significant (<italic>p</italic> &lt; 0.001). The best results (lowest distance) were attained using ARD with group constraints. These results were significantly better than for GS with group constraints (<italic>p</italic> = 0.008). Again, ARD benefits significantly more from group constraints, relative to GS. In fact, in terms of spatial precision it outperformed GS (but not in terms of sensitivity), provided it has access to group constraints. As above this may reflect the focal nature of sensory evoked potentials in this paradigm.</p>
      </sec>
    </sec>
    <sec>
      <title>Discussion</title>
      <p>Source reconstructions with multiple sparse priors (<xref rid="bib6" ref-type="bibr">Friston et al., 2008a</xref>) yield solutions which are much more focal than those provided by classical minimum norm models. Furthermore, they have significantly higher model evidences in relation to single-subject data. However, the regional specificity of these solutions turns into a disadvantage when contrast images are pooled across different experiments. This is because inter-subject variability in regional effects can lead to low <italic>t</italic>-values, when sources do not overlap. One way to solve this problem is through spatial smoothing of reconstructed images. However this compromises spatial resolution and subverts the main advantage of multiple sparse priors. Our present study shows that introduction of group constraints makes it possible to attain <italic>t</italic>-values close to those of minimum norm (<xref rid="fig4" ref-type="fig">Fig. 4</xref>A); with solutions that remain focal and consistent across subjects (<xref rid="fig4" ref-type="fig">Fig. 4</xref>B).</p>
      <p>Group constraints may lead to a reduction of model evidence for individual subject data. In the present study, however, this was observed only for GS. For ARD the evidence was actually higher with group constraints (<xref rid="fig2" ref-type="fig">Fig. 2</xref>B), suggesting exploration of hyperparameter or model space was somehow finessed by information from other subjects. On comparing the two methods with group constraints, GS and ARD, we conclude that both yield similar <italic>t</italic>-values (close to those of minimum norm case). The largest <italic>t</italic>-values were provided by GS with group constraints; however, for ARD with group constraints the solutions were, anatomically, more consistent across replications. ARD benefited much more than GS from group constraints and this may reflect the large number of hyperparameters it has to optimise. Without group constraints GS is clearly better according to all the three criteria: model evidence, <italic>t</italic>-values and spatial precision.</p>
    </sec>
    <sec>
      <title>Conclusion</title>
      <p>We have described a simple device that allows one to place constraints on reconstructed source activity in the context of group studies. This is not a full hierarchical inversion but finesses single-subject source reconstruction; as a prelude to summarizing subject-specific responses for classical inference at the group level. Our analyses suggest that this between-subject constraint markedly increases the reliability of detecting systematic responses over subjects, in terms of their functional anatomy. The inversion procedure is based upon generic variational techniques and yet proceeds quickly and efficiently, using only second-order statistics in channel space. This means the entire inversion for several subjects takes seconds (as opposed to minutes).</p>
    </sec>
  </body>
  <back>
    <ack>
      <title>Acknowledgments</title>
      <p>This work was funded by the Wellcome trust. VL is recipient of a Marie Curie Intra European fellowship (contract MEIF-CT-2006-038858). We would like to thank Justin Chumbley for invaluable help with statistical analyses and Rik Henson for helpful discussions.</p>
      <p>
        <bold>Software note</bold>
      </p>
      <p>The algorithm and schemes introduced in this paper are available as academic freeware as part of the SPM software package (<ext-link xlink:href="http://www.fil.ion.ucl.ac.uk/spm" ext-link-type="uri">http://www.fil.ion.ucl.ac.uk/spm</ext-link>). The group inversion scheme can be accessed through the 3D-source reconstruction by selecting “group inversion”. Forward models will then be built automatically and the group inversion described in this paper implemented. All the user has to supply is the names of the data files and the locations of the sensors and fiducials.</p>
    </ack>
    <fn-group>
      <fn id="fn1">
        <label>1</label>
        <p>We will treat trials and subjects as interchangeable for simplicity. In practice, one would normally invert several trial types (<italic>i.e</italic>., conditions) from several subjects by holding the subject-specific quantities constant over trials.</p>
      </fn>
      <fn id="fn2">
        <label>2</label>
        <p>The scheme can be extended easily to model multiple covariance components for channel noise.</p>
      </fn>
      <fn id="fn3">
        <label>3</label>
        <p>Here, a model <italic>m</italic> is defined in terms of the number and form of covariance components.</p>
      </fn>
      <fn id="fn4">
        <label>4</label>
        <p>This is formally related to the restricted maximum likelihood (ReML) objective function (<xref rid="bib8" ref-type="bibr">Harville, 1977</xref>) and is essentially the Kullback-Leibler divergence between the observed and expected Gaussian densities (ignoring hyperpriors and constants).</p>
      </fn>
      <fn id="fn5">
        <label>5</label>
        <p>For the single subject <italic>D</italic> = <italic>n</italic> and for the group, <italic>D</italic> = <italic>nN</italic>.</p>
      </fn>
      <fn id="fn6">
        <label>6</label>
        <p>Strictly speaking the <italic>t</italic>-value summary statistics cannot be treated as independent summaries, over the 100 realisations of the group analyses, because these realisations borrowed data from the same five experiments in each subject. However, we appeal to the sphericity of mildly correlated but uniform correlations, among the ensuing errors over groups, to eschew a correction for non-sphericity. Heuristically, each of the 100 distinct combinations of the five experiments brings a degree of freedom to the inference about effects over groups.</p>
      </fn>
    </fn-group>
    <ref-list>
      <title>References</title>
      <ref id="bib1">
        <label>Allison et al., 1991</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Allison</surname>
              <given-names>T.</given-names>
            </name>
            <name>
              <surname>McCarthy</surname>
              <given-names>G.</given-names>
            </name>
            <name>
              <surname>Wood</surname>
              <given-names>C.C.</given-names>
            </name>
            <name>
              <surname>Jones</surname>
              <given-names>S.J.</given-names>
            </name>
          </person-group>
          <article-title>Potentials evoked in human and monkey cerebral cortex by stimulation of the median nerve. A review of scalp and intracranial recordings</article-title>
          <source>Brain</source>
          <year>1991</year>
          <volume>114</volume>
          <fpage>2465</fpage>
          <lpage>2503</lpage>
          <pub-id pub-id-type="pmid">1782527</pub-id>
        </citation>
      </ref>
      <ref id="bib2">
        <label>Baillet and Garnero, 1997</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Baillet</surname>
              <given-names>S.</given-names>
            </name>
            <name>
              <surname>Garnero</surname>
              <given-names>L.</given-names>
            </name>
          </person-group>
          <article-title>A Bayesian approach to introducing anatomo-functional priors in the EEG/MEG inverse problem</article-title>
          <source>IEEE Trans. Biomed. Eng.</source>
          <year>1997</year>
          <volume>44</volume>
          <issue>5</issue>
          <fpage>374</fpage>
          <lpage>385</lpage>
          <pub-id pub-id-type="pmid">9125822</pub-id>
        </citation>
      </ref>
      <ref id="bib3">
        <label>Friston et al., 2005</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Friston</surname>
              <given-names>K.J.</given-names>
            </name>
            <name>
              <surname>Stephan</surname>
              <given-names>K.E.</given-names>
            </name>
            <name>
              <surname>Lund</surname>
              <given-names>T.E.</given-names>
            </name>
            <name>
              <surname>Morcom</surname>
              <given-names>A.</given-names>
            </name>
            <name>
              <surname>Kiebel</surname>
              <given-names>S.</given-names>
            </name>
          </person-group>
          <article-title>Mixed-effects and fMRI studies</article-title>
          <source>NeuroImage</source>
          <year>2005</year>
          <volume>24</volume>
          <issue>1</issue>
          <fpage>244</fpage>
          <lpage>252</lpage>
          <comment>(Jan 1)</comment>
          <pub-id pub-id-type="pmid">15588616</pub-id>
        </citation>
      </ref>
      <ref id="bib4">
        <label>Friston et al., 2006</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Friston</surname>
              <given-names>K.J.</given-names>
            </name>
            <name>
              <surname>Henson</surname>
              <given-names>R.</given-names>
            </name>
            <name>
              <surname>Phillips</surname>
              <given-names>C.</given-names>
            </name>
            <name>
              <surname>Mattout</surname>
              <given-names>J.</given-names>
            </name>
          </person-group>
          <article-title>Bayesian estimation of evoked and induced responses</article-title>
          <source>Hum. Brain Mapp.</source>
          <year>2006</year>
          <volume>27</volume>
          <issue>9</issue>
          <fpage>722</fpage>
          <lpage>735</lpage>
          <pub-id pub-id-type="pmid">16453291</pub-id>
        </citation>
      </ref>
      <ref id="bib5">
        <label>Friston et al., 2007</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Friston</surname>
              <given-names>K.</given-names>
            </name>
            <name>
              <surname>Mattout</surname>
              <given-names>J.</given-names>
            </name>
            <name>
              <surname>Trujillo-Barreto</surname>
              <given-names>N.</given-names>
            </name>
            <name>
              <surname>Ashburner</surname>
              <given-names>J.</given-names>
            </name>
            <name>
              <surname>Penny</surname>
              <given-names>W.</given-names>
            </name>
          </person-group>
          <article-title>Variational free energy and the Laplace approximation</article-title>
          <source>NeuroImage</source>
          <year>2007</year>
          <volume>34</volume>
          <issue>1</issue>
          <fpage>220</fpage>
          <lpage>234</lpage>
          <pub-id pub-id-type="pmid">17055746</pub-id>
        </citation>
      </ref>
      <ref id="bib6">
        <label>Friston et al., 2008a</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Friston</surname>
              <given-names>K.</given-names>
            </name>
            <name>
              <surname>Harrison</surname>
              <given-names>L.</given-names>
            </name>
            <name>
              <surname>Daunizeau</surname>
              <given-names>J.</given-names>
            </name>
            <name>
              <surname>Kiebel</surname>
              <given-names>S.</given-names>
            </name>
            <name>
              <surname>Phillips</surname>
              <given-names>C.</given-names>
            </name>
            <name>
              <surname>Trujillo-Barreto</surname>
              <given-names>N.</given-names>
            </name>
            <name>
              <surname>Henson</surname>
              <given-names>R.</given-names>
            </name>
            <name>
              <surname>Flandin</surname>
              <given-names>G.</given-names>
            </name>
            <name>
              <surname>Mattout</surname>
              <given-names>J.</given-names>
            </name>
          </person-group>
          <article-title>Multiple sparse priors for the M/EEG inverse problem</article-title>
          <source>NeuroImage</source>
          <year>2008</year>
          <volume>39</volume>
          <issue>3</issue>
          <fpage>1104</fpage>
          <lpage>1120</lpage>
          <comment>(Feb 1)</comment>
          <pub-id pub-id-type="pmid">17997111</pub-id>
        </citation>
      </ref>
      <ref id="bib7">
        <label>Friston et al., 2008b</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Friston</surname>
              <given-names>K.</given-names>
            </name>
            <name>
              <surname>Chu</surname>
              <given-names>C.</given-names>
            </name>
            <name>
              <surname>Mourão-Miranda</surname>
              <given-names>J.</given-names>
            </name>
            <name>
              <surname>Hulme</surname>
              <given-names>O.</given-names>
            </name>
            <name>
              <surname>Rees</surname>
              <given-names>G.</given-names>
            </name>
            <name>
              <surname>Penny</surname>
              <given-names>W.</given-names>
            </name>
            <name>
              <surname>Ashburner</surname>
              <given-names>J.</given-names>
            </name>
          </person-group>
          <article-title>Bayesian decoding of brain images</article-title>
          <source>NeuroImage</source>
          <year>2008</year>
          <volume>39</volume>
          <issue>1</issue>
          <fpage>181</fpage>
          <lpage>205</lpage>
          <comment>(Jan 1)</comment>
          <pub-id pub-id-type="pmid">17919928</pub-id>
        </citation>
      </ref>
      <ref id="bib8">
        <label>Harville, 1977</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Harville</surname>
              <given-names>D.A.</given-names>
            </name>
          </person-group>
          <article-title>Maximum likelihood approaches to variance component estimation and to related problems</article-title>
          <source>J. Am. Stat. Assoc.</source>
          <year>1977</year>
          <volume>72</volume>
          <fpage>320</fpage>
          <lpage>338</lpage>
        </citation>
      </ref>
      <ref id="bib9">
        <label>Jun et al., 2006</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Jun</surname>
              <given-names>S.C.</given-names>
            </name>
            <name>
              <surname>George</surname>
              <given-names>J.S.</given-names>
            </name>
            <name>
              <surname>Plis</surname>
              <given-names>S.M.</given-names>
            </name>
            <name>
              <surname>Ranken</surname>
              <given-names>D.M.</given-names>
            </name>
            <name>
              <surname>Schmidt</surname>
              <given-names>D.M.</given-names>
            </name>
            <name>
              <surname>Wood</surname>
              <given-names>C.C.</given-names>
            </name>
          </person-group>
          <article-title>Improving source detection and separation in a spatiotemporal Bayesian inference dipole analysis</article-title>
          <source>Phys. Med. Biol.</source>
          <year>2006</year>
          <volume>51</volume>
          <issue>10</issue>
          <fpage>2395</fpage>
          <lpage>2414</lpage>
          <pub-id pub-id-type="pmid">16675860</pub-id>
        </citation>
      </ref>
      <ref id="bib10">
        <label>Kass and Steffey, 1989</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Kass</surname>
              <given-names>R.E.</given-names>
            </name>
            <name>
              <surname>Steffey</surname>
              <given-names>D.</given-names>
            </name>
          </person-group>
          <article-title>Approximate Bayesian inference in conditionally independent hierarchical models (parametric empirical Bayes models)</article-title>
          <source>J. Am. Stat. Assoc.</source>
          <year>1989</year>
          <volume>407</volume>
          <fpage>717</fpage>
          <lpage>726</lpage>
        </citation>
      </ref>
      <ref id="bib11">
        <label>Kiebel and Friston, 2004</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Kiebel</surname>
              <given-names>S.J.</given-names>
            </name>
            <name>
              <surname>Friston</surname>
              <given-names>K.J.</given-names>
            </name>
          </person-group>
          <article-title>Statistical parametric mapping for event-related potentials (II): a hierarchical temporal model</article-title>
          <source>NeuroImage</source>
          <year>2004</year>
          <volume>22</volume>
          <issue>2</issue>
          <fpage>503</fpage>
          <lpage>520</lpage>
          <pub-id pub-id-type="pmid">15193579</pub-id>
        </citation>
      </ref>
      <ref id="bib12">
        <label>Litvak et al., 2007</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Litvak</surname>
              <given-names>V.</given-names>
            </name>
            <name>
              <surname>Zeller</surname>
              <given-names>D.</given-names>
            </name>
            <name>
              <surname>Oostenveld</surname>
              <given-names>R.</given-names>
            </name>
            <name>
              <surname>Maris</surname>
              <given-names>E.</given-names>
            </name>
            <name>
              <surname>Cohen</surname>
              <given-names>A.</given-names>
            </name>
            <name>
              <surname>Schramm</surname>
              <given-names>A.</given-names>
            </name>
            <name>
              <surname>Gentner</surname>
              <given-names>R.</given-names>
            </name>
            <name>
              <surname>Zaaroor</surname>
              <given-names>M.</given-names>
            </name>
            <name>
              <surname>Pratt</surname>
              <given-names>H.</given-names>
            </name>
            <name>
              <surname>Classen</surname>
              <given-names>J.</given-names>
            </name>
          </person-group>
          <article-title>LTP-like changes induced by paired associative stimulation of the primary somatosensory cortex in humans: source analysis and associated changes in behaviour</article-title>
          <source>Eur. J. Neurosci.</source>
          <year>2007</year>
          <volume>25</volume>
          <fpage>2862</fpage>
          <lpage>2874</lpage>
          <pub-id pub-id-type="pmid">17561848</pub-id>
        </citation>
      </ref>
      <ref id="bib13">
        <label>Mattout et al., 2006</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Mattout</surname>
              <given-names>J.</given-names>
            </name>
            <name>
              <surname>Phillips</surname>
              <given-names>C.</given-names>
            </name>
            <name>
              <surname>Penny</surname>
              <given-names>W.D.</given-names>
            </name>
            <name>
              <surname>Rugg</surname>
              <given-names>M.D.</given-names>
            </name>
            <name>
              <surname>Friston</surname>
              <given-names>K.J.</given-names>
            </name>
          </person-group>
          <article-title>MEG source localization under multiple constraints: an extended Bayesian framework</article-title>
          <source>NeuroImage</source>
          <year>2006</year>
          <volume>30</volume>
          <fpage>753</fpage>
          <lpage>767</lpage>
          <pub-id pub-id-type="pmid">16368248</pub-id>
        </citation>
      </ref>
      <ref id="bib14">
        <label>Mattout et al., 2007</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Mattout</surname>
              <given-names>J.</given-names>
            </name>
            <name>
              <surname>Henson</surname>
              <given-names>R.N.</given-names>
            </name>
            <name>
              <surname>Friston</surname>
              <given-names>K.J.</given-names>
            </name>
          </person-group>
          <article-title>Canonical source reconstruction for MEG</article-title>
          <source>Comput. Intell. Neurosci.</source>
          <year>2007</year>
          <fpage>67613</fpage>
          <pub-id pub-id-type="pmid">18350131</pub-id>
        </citation>
      </ref>
      <ref id="bib15">
        <label>Neal, 1998</label>
        <citation citation-type="book">
          <person-group person-group-type="author">
            <name>
              <surname>Neal</surname>
              <given-names>R.M.</given-names>
            </name>
          </person-group>
          <article-title>Assessing relevance determination methods using DELVE</article-title>
          <source>In Neural Networks and Machine Learning</source>
          <year>1998</year>
          <publisher-name>Springer</publisher-name>
          <fpage>97</fpage>
          <lpage>129</lpage>
        </citation>
      </ref>
      <ref id="bib16">
        <label>Nummenmaa et al., 2007</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Nummenmaa</surname>
              <given-names>A.</given-names>
            </name>
            <name>
              <surname>Auranen</surname>
              <given-names>T.</given-names>
            </name>
            <name>
              <surname>Hamalainen</surname>
              <given-names>M.S.</given-names>
            </name>
            <name>
              <surname>Jääskeläinen</surname>
              <given-names>I.P.</given-names>
            </name>
            <name>
              <surname>Lampinen</surname>
              <given-names>J.</given-names>
            </name>
            <name>
              <surname>Sams</surname>
              <given-names>M.</given-names>
            </name>
            <name>
              <surname>Vehtari</surname>
              <given-names>A.</given-names>
            </name>
          </person-group>
          <article-title>Hierarchical Bayesian estimates of distributed MEG sources: theoretical aspects and comparison of variational and MCMC methods</article-title>
          <source>NeuroImage</source>
          <year>2007</year>
          <volume>35</volume>
          <issue>2</issue>
          <fpage>669</fpage>
          <lpage>685</lpage>
          <pub-id pub-id-type="pmid">17300961</pub-id>
        </citation>
      </ref>
      <ref id="bib17">
        <label>Phillips et al., 2002</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Phillips</surname>
              <given-names>C.</given-names>
            </name>
            <name>
              <surname>Rugg</surname>
              <given-names>M.</given-names>
            </name>
            <name>
              <surname>Friston</surname>
              <given-names>K.J.</given-names>
            </name>
          </person-group>
          <article-title>Systematic regularisation of linear inverse solutions of the EEG source localisation problem</article-title>
          <source>NeuroImage</source>
          <year>2002</year>
          <volume>17</volume>
          <fpage>287</fpage>
          <lpage>301</lpage>
          <pub-id pub-id-type="pmid">12482084</pub-id>
        </citation>
      </ref>
      <ref id="bib18">
        <label>Phillips et al., 2005</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Phillips</surname>
              <given-names>C.</given-names>
            </name>
            <name>
              <surname>Mattout</surname>
              <given-names>J.</given-names>
            </name>
            <name>
              <surname>Rugg</surname>
              <given-names>M.D.</given-names>
            </name>
            <name>
              <surname>Maquet</surname>
              <given-names>P.</given-names>
            </name>
            <name>
              <surname>Friston</surname>
              <given-names>K.J.</given-names>
            </name>
          </person-group>
          <article-title>An empirical Bayesian solution to the source reconstruction problem in EEG</article-title>
          <source>NeuroImage</source>
          <year>2005</year>
          <volume>24</volume>
          <issue>4</issue>
          <fpage>997</fpage>
          <lpage>1011</lpage>
          <pub-id pub-id-type="pmid">15670677</pub-id>
        </citation>
      </ref>
      <ref id="bib19">
        <label>Sato et al., 2004</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Sato</surname>
              <given-names>M.A.</given-names>
            </name>
            <name>
              <surname>Yoshioka</surname>
              <given-names>T.</given-names>
            </name>
            <name>
              <surname>Kajihara</surname>
              <given-names>S.</given-names>
            </name>
            <name>
              <surname>Toyama</surname>
              <given-names>K.</given-names>
            </name>
            <name>
              <surname>Goda</surname>
              <given-names>N.</given-names>
            </name>
            <name>
              <surname>Doya</surname>
              <given-names>K.</given-names>
            </name>
            <name>
              <surname>Kawato</surname>
              <given-names>M.</given-names>
            </name>
          </person-group>
          <article-title>Hierarchical Bayesian estimation for MEG inverse problem</article-title>
          <source>NeuroImage</source>
          <year>2004</year>
          <volume>23</volume>
          <issue>3</issue>
          <fpage>806</fpage>
          <lpage>826</lpage>
          <pub-id pub-id-type="pmid">15528082</pub-id>
        </citation>
      </ref>
      <ref id="bib20">
        <label>Serinagaoglu et al., 2005</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Serinagaoglu</surname>
              <given-names>Y.</given-names>
            </name>
            <name>
              <surname>Brooks</surname>
              <given-names>D.H.</given-names>
            </name>
            <name>
              <surname>MacLeod</surname>
              <given-names>R.S.</given-names>
            </name>
          </person-group>
          <article-title>Bayesian solutions and performance analysis in bioelectric inverse problems</article-title>
          <source>IEEE Trans. Biomed. Eng.</source>
          <year>2005</year>
          <volume>52</volume>
          <issue>6</issue>
          <fpage>1009</fpage>
          <lpage>1020</lpage>
          <pub-id pub-id-type="pmid">15977731</pub-id>
        </citation>
      </ref>
      <ref id="bib21">
        <label>Talairach and Tournoux, 1988</label>
        <citation citation-type="book">
          <person-group person-group-type="author">
            <name>
              <surname>Talairach</surname>
              <given-names>J.</given-names>
            </name>
            <name>
              <surname>Tournoux</surname>
              <given-names>P.</given-names>
            </name>
          </person-group>
          <article-title>Co-planar Stereotaxic Atlas of the Human Brain: 3-Dimensional Proportional System — An Approach to Cerebral Imaging</article-title>
          <year>1988</year>
          <publisher-name>Thieme Medical Publishers</publisher-name>
          <publisher-loc>New York, NY</publisher-loc>
        </citation>
      </ref>
      <ref id="bib22">
        <label>Tipping, 2001</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Tipping</surname>
              <given-names>M.E.</given-names>
            </name>
          </person-group>
          <article-title>Sparse Bayesian learning and the relevance vector machine</article-title>
          <source>J. Mach. Learn. Res.</source>
          <year>2001</year>
          <volume>1</volume>
          <fpage>211</fpage>
          <lpage>244</lpage>
        </citation>
      </ref>
      <ref id="bib23">
        <label>Trujillo-Barreto et al., 2004</label>
        <citation citation-type="journal">
          <person-group person-group-type="author">
            <name>
              <surname>Trujillo-Barreto</surname>
              <given-names>N.</given-names>
            </name>
            <name>
              <surname>Aubert-Vazquez</surname>
              <given-names>E.</given-names>
            </name>
            <name>
              <surname>Valdes-Sosa</surname>
              <given-names>P.</given-names>
            </name>
          </person-group>
          <article-title>Bayesian model averaging</article-title>
          <source>NeuroImage</source>
          <year>2004</year>
          <volume>21</volume>
          <fpage>1300</fpage>
          <lpage>1319</lpage>
          <pub-id pub-id-type="pmid">15050557</pub-id>
        </citation>
      </ref>
      <ref id="bib24">
        <label>Wipf and Nagarajan, in press</label>
        <citation citation-type="other">Wipf, D. Nagarajan, S., in press. A Unified Bayesian Framework for MEG/EEG Source Imaging. NeuroImage.</citation>
      </ref>
    </ref-list>
  </back>
  <floats-wrap>
    <fig id="fig1">
      <label>Fig. 1</label>
      <caption>
        <p>Schematic of the two-stage source reconstruction scheme for group studies. See main text for a detailed explanation of the variables.</p>
      </caption>
      <graphic xlink:href="gr1"/>
    </fig>
    <fig id="fig2">
      <label>Fig. 2</label>
      <caption>
        <p>(A) Distributions of the values of free-energy bound to the log-evidence for the four reconstruction methods compared in the present study relative to minimum norm. The distributions are presented as box-plots with lines at the lower quartile, median, and upper quartile values. Values beyond the 1.5 interquartile range from the median are shown as outliers. For gGS and gARD the value for each experiment is an average of ∼ 20 values obtained when that experiment participated in reconstructions with group constraints. (B) Distributions of differences between the average log-evidences and the value obtained for source reconstruction without group constraints.</p>
      </caption>
      <graphic xlink:href="gr2"/>
    </fig>
    <fig id="fig3">
      <label>Fig. 3</label>
      <caption>
        <p>Results of paired <italic>t</italic>-tests comparing the reconstructed images with the midsagittal-flipped version of the same images. All models show maximal activation around the left sensorimotor area. However they differ greatly with respect to the number of suprathreshold voxels. These SPMs have been thresholded at the same level (<italic>p</italic> &lt; 0.001; uncorrected) and the location of the maximum <italic>t</italic>-value is marked by a red pointer in each SPM.</p>
      </caption>
      <graphic xlink:href="gr3"/>
    </fig>
    <fig id="fig4">
      <label>Fig. 4</label>
      <caption>
        <p>Cumulative distributions of the ‘quality measures’ for the <italic>t</italic>-test SPMs, such as shown in <xref rid="fig2" ref-type="fig">Fig. 2</xref>, across 100 repetitions using randomly selected groups of 11 experiments with the same 11 subjects. (A) The maximal <italic>t</italic>-value in the image. (B) The distance of the voxel with the maximal <italic>t</italic>-value from the ‘mean location’ over the 100 group analyses, with the same reconstruction scheme.</p>
      </caption>
      <graphic xlink:href="gr4"/>
    </fig>
  </floats-wrap>
</article>